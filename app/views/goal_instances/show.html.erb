<div class="container">

<% if notice %>
<div class="alert alert-success" >
	<button type="button" class="close" data-dismiss="alert">&times;</button>
	<p id="notice"><%= notice %></p>
</div>
<% end %>

<% whole = (@goal_instance.end_date-@goal_instance.start_date).to_f %>
<% complete = 0 %>
        	
<div class="media">
	<a class="pull-left" href="#">
		<%= image_tag @goal_instance.goal.picture.url, :class => "media-object", :width => "300px", :height => "200px" %>	</a>
	<div class="media-body">
		<div class="page-header">
			<h1>
				<%= @goal_instance.goal.title %>
				<br />
				<small><%= @goal_instance.goal.description %></small>
			</h1>
		</div>
		<div class="container" class="pull-left">
			<div class="row">
				<div class="col-sm-5"> <b> Started At</b></div>
				<div class="col-sm-5"> <%= @goal_instance.start_date%></div>
			<br \>
			</div>
			<div class="row">
				<div class="col-sm-5"> <b> End By </b></div>
				<div class="col-sm-5"> <%= @goal_instance.end_date%></div>
			</div>
			<br \>
			<div class="row">
				<div class="col-sm-5"> <b>
					<% if User.find(session[:current_user]) == @goal_instance.user then %>
					You have <%=@goal_instance.cheer_ons%> cheer ons for this goal.
					<% else %> <%=@goal_instance.user.first_name %> has <%=@goal_instance.cheer_ons%> cheer ons for this goal.
					<%end%>
				</b></div>
				<div class="col-sm-5"><b>
					<% if User.find(session[:current_user]) != @goal_instance.user then %>
						<%= button_to 'Cheer on', {:action => 'cheeron', remote: true }, :class => 'btn btn-success btn-xs', :method => :put%> 
					<% end %>
				</div>	
			</div>
	</div>
	</div>
</div>
<br />	

<div class="container" class="pull-right">
      <% sum = 0 %>
      <% @milestones.each do |milestone| 
              sum = sum + milestone.duration.to_i 
              end%>
  	<div class="row">
  	<div class="col-sm-7">
  		<br \>
  		<div class="row">
  			<div class="col-sm-7">
  			<% if User.find(session[:current_user]) == @goal_instance.user then %>
  			Your Milestones
  			<%else%> <%= @goal_instance.user.first_name %> 's Milestones
  			<%end%></div>
  		</div>
        <%  @milestones.each do |milestone| %>
        <br \>
        <div class="row">
         <div class="col-sm-3">
                 <% if User.find(session[:current_user]) == @goal_instance.user then %>
                         <% if !milestone.is_complete then %>
                                 <%= button_to 'Incomplete', {:action => 'check', :milestone_id => milestone.id, :remote => true}, :class => 'btn btn-danger btn-xs', :method => :put%>
                         <% elsif milestone.is_complete then %> 
                                  <button type="button" class="btn btn-success btn-xs">Complete</button>
                                 <% complete = complete + (@goal_instance.end_date - @goal_instance.start_date) * (milestone.duration.to_f/sum.to_f) %>
                         <%end%>
                 <%else%>
                         <% if !milestone.is_complete then %>
                                 <button type="button" class="btn btn-danger btn-xs">Incomplete</button>
                         <% elsif milestone.is_complete then %> 
                                 <button type="button" class="btn btn-success btn-xs">Complete</button>
                                 <% complete = complete + (@goal_instance.end_date - @goal_instance.start_date) * (milestone.duration.to_f/sum.to_f) %>
                         <%end%>
                 <%end%></div>
        <div class="col-sm-2"><%= milestone.description %></b></div>
        <div class="col-sm-1"><%= (@goal_instance.end_date - @goal_instance.start_date) * (milestone.duration.to_f/sum.to_f) %></b></div>
    	</div>   
    <% end %>
</div>
<div class="col-sm-2">
		<% if complete == 0 then %>
		<img src="<%= Gchart.pie(:data => [0,whole], :labels => ["","Incomplete"])%>"/>
		<% elsif whole == complete then %>
		<img src="<%= Gchart.pie(:data => [whole,0], :labels => ["Complete"])%>"/>
		<% else %>
		<img src="<%= Gchart.pie(:data => [complete,whole - complete], :labels =>["Complete","Incomplete"])%>"/>
		<%end%>
</div>
</div>
</div>
<% if whole == complete then %>
 <div class="alert alert-success" >
	<button type="button" class="close" data-dismiss="alert">&times;</button>
	<p id="notice">Congratulations! You completed this goal</p>
</div>
<%end%>

<div class="pull-left">
<div class="media">
		<div class="container">
			<div class="row">
				<%if User.find(session[:current_user]) == @goal_instance.user %>
					<div class="col-xs-1"><%=link_to 'Edit', edit_goal_instance_path(@goal_instance)%> </div>
					<div class="col-xs-1"><%=button_to 'Delete', @goal_instance, method: :delete, html_options: {confirm: 'Are you sure?'}, :class => 'button'%></div>
				<%end%> 
				<div class="col-xs-1"><%= link_to 'Back', goal_instances_path(:user_id => @goal_instance.user.id) %></div>
			</div>
		</div>
</div>
</div>



